{% extends "base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/account.css'%}">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
{% endblock %}

{% block content %}
    {% include "header.html" %}
        <div class="account">
            <div class="account-title">
                <p style="font-size: 24px;">
                    Здравствуйте, <b>{{ name }}</b>
                </p>
                <a href="{% url 'usersettings' %}" >
                    <img src="{% static 'img/settings.svg' %}" />
                </a>
            </div>
            {% include "booking.html" %}
            <div class="account-actions">
                <div class="all-bookings">
                    <p class="header-title">Текущее бронирование</p>
                    {% if current_bookings %}
                        {% for b in current_bookings %}
                        <div class="booking-list">
                            <img src="{{ b.room.image_url }}" />
                            <div class="cur-room-description">
                                <div class="text-description">
                                    <p><b>Номер</b> {{ b.room.get_room_type_display }}</p>
                                    <p><b>Даты</b> {{ b.check_in }} – {{ b.check_out }}</p>
                                    <p><b>Гости</b> {{ b.guests }}, дети {{ b.children }}</p>
                                </div>
                                <div class="order-service">
                                    <a href="{% url 'restaurants' booking_pk=b.pk %}">
                                        Заказать еду в номер
                                      </a>
                                    <a href="{% url 'cleaning' b.pk %}" class="cleaning-order-btn">Клининг номера</a>
                                </div>
                                <form method="post" action="{% url 'cancel_booking' b.pk %}">
                                    {% csrf_token %}
                                    <button type="submit">Отменить бронирование</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p>У вас нет активных броней.</p>
                    {% endif %}
                        <p class="header-title">
                            История бронирования
                        </p>
                        {% if past_bookings %}
                            {% for b in past_bookings %}
                            <div class="booking-list">
                                <img src="{{ b.room.image_url }}" />
                                <div class="cur-room-description">
                                    <div class="text-description">
                                    <p><b>Номер</b> {{ b.room.get_room_type_display }}</p>
                                    <p><b>Даты</b> {{ b.check_in }} – {{ b.check_out }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            <p class="header-title"><a href="{% url 'leave_review' %}">Оставить отзыв</a></p>
                        {% else %}
                            <p style="font-size: 16px; padding-left: 32px;">У вас пока нет завершённых броней.</p>
                        {% endif %}
                </div>
                <div class="devider"></div>
                <div class="services">
                    <p class="header-title">Услуги</p>
                    <div class="cur-services">
                      {% for b in current_bookings %}
                        <div class="booking-services">
                          <h4>Бронь №{{ b.id }}: {{ b.room }}</h4>
                  
                          {# Еда #}
                          {% if b.food_orders %}
                            <div class="food-order-info">
                              <p><b>Еда заказана:</b></p>
                              <ul>
                                {% for ci in b.food_orders %}
                                  <li>{{ ci.dish.name }} × {{ ci.quantity }}</li>
                                {% endfor %}
                              </ul>
                            </div>
                          {% endif %}
                  
                          {# Клининг #}
                          {% if b.cleaning_today %}
                            <div class="cleaning-order-info">
                              <p><b>Клининг на сегодня для {{ b.room }}:</b></p>
                              <ul>
                                {% for co in b.cleaning_today %}
                                  <li>{{ co.order_time }}</li>
                                {% endfor %}
                              </ul>
                            </div>
                          {% endif %}
                  
                          {# Если ни еды, ни клининга нет #}
                          {% if not b.food_orders and not b.cleaning_orders.all %}
                            <p>Для этого бронирования пока нет ни заказа еды, ни клининга.</p>
                          {% endif %}
                        </div>
                      {% empty %}
                        <p>У вас пока нет активных бронирований.</p>
                      {% endfor %}
                    </div>
                  </div>
                  
            </div>
        </div>
{% endblock %}